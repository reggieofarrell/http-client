# OpenAPI SDK Code Generator

The OpenAPI SDK Code Generator is a powerful tool that automatically generates strongly-typed SDK clients from OpenAPI 3.0+ specifications. It creates TypeScript clients that extend the `HttpClient` class with organized route groups and TypeScript types generated by `openapi-typescript`.

## Features

- 🚀 **Automatic Code Generation**: Generate complete SDK clients from OpenAPI specs
- 🔒 **Strongly Typed**: Full TypeScript support with types generated by `openapi-typescript`
- 📦 **Modular Structure**: Organized route groups and type files
- 🛡️ **Type Safety**: Comprehensive TypeScript types for all API operations
- 🎯 **Smart Grouping**: Group endpoints by OpenAPI tags or path segments
- 🔧 **Customizable**: Configurable client names, grouping strategies, and more

## Installation

The code generator is available as a separate export from the http-client package. Install the required peer dependencies:

```bash
npm install @reggieofarrell/http-client openapi-typescript
```

## Quick Start

```typescript
import { generateClient } from '@reggieofarrell/http-client/codegen';

// Generate a client from an OpenAPI specification
await generateClient({
  openApiSpec: './openapi.json',
  outputDir: './src/api-client',
  clientName: 'MyApiClient',
});
```

## Usage

### Basic Usage

```typescript
import { generateClient } from '@reggieofarrell/http-client/codegen';

await generateClient({
  openApiSpec: './openapi.json',        // Path to OpenAPI spec
  outputDir: './src/api-client',        // Output directory
  clientName: 'MyApiClient',            // Optional: custom client name
});
```

### Advanced Configuration

```typescript
await generateClient({
  openApiSpec: './openapi.json',
  outputDir: './src/api-client',
  clientName: 'MyApiClient',
  groupingStrategy: 'tags',             // 'tags' or 'path'
  includeDeprecated: false,             // Skip deprecated endpoints
  validateSchemas: false,               // Enable Zod validation
});
```

## Generated Code Structure

The generator creates a well-organized file structure:

```
src/api-client/
├── client.ts                 # Main client class
├── index.ts                  # Main exports
├── routes/
│   ├── users.route.ts        # Users route group
│   ├── documents.route.ts    # Documents route group
│   └── index.ts              # Route exports
├── schemas/
│   ├── user.schema.ts        # User Zod schemas
│   ├── document.schema.ts    # Document Zod schemas
│   └── index.ts              # Schema exports
└── errors/
    └── api-errors.ts         # Custom error classes (if needed)
```

## Generated Client Example

```typescript
import { MyApiClient } from './api-client';

const client = new MyApiClient({
  baseURL: 'https://api.example.com',
});

// Fully typed methods!
const users = await client.users.listUsers();
const user = await client.users.getUser({ id: '123' });
const newUser = await client.users.createUser({
  name: 'John Doe',
  email: 'john@example.com'
});

const documents = await client.documents.listDocuments({ limit: 10 });
```

## Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `openApiSpec` | `string \| object` | Required | OpenAPI specification (file path or object) |
| `outputDir` | `string` | Required | Directory for generated files |
| `clientName` | `string` | Auto-generated | Name of the generated client class |
| `groupingStrategy` | `'tags' \| 'path'` | `'tags'` | How to group endpoints |
| `includeDeprecated` | `boolean` | `false` | Include deprecated endpoints |
| `validateSchemas` | `boolean` | `false` | Enable Zod validation |

## Route Grouping

### By Tags (Default)

Endpoints are grouped by their OpenAPI tags:

```yaml
paths:
  /users:
    get:
      tags: [users]
  /users/{id}:
    get:
      tags: [users]
```

Generates: `client.users.listUsers()`, `client.users.getUser()`

### By Path

Endpoints are grouped by the first path segment:

```yaml
paths:
  /api/users:
    get:
  /api/documents:
    get:
```

Generates: `client.api.listUsers()`, `client.api.listDocuments()`

## Schema Generation

The generator automatically creates Zod schemas from OpenAPI schemas:

```typescript
// Generated from OpenAPI schema
export const UserSchema = z.object({
  id: z.string(),
  name: z.string(),
  email: z.string().email(),
  age: z.number().int().min(0).optional(),
  createdAt: z.string().datetime(),
});

export type User = z.infer<typeof UserSchema>;
```

## Error Handling

The generator creates custom error classes when API error responses differ from standard HTTP errors:

```typescript
// Generated custom error class
export class ApiError400Error extends HttpError {
  code: string;
  message: string;
  details?: string;
}
```

## Integration with Build Tools

### Package.json Scripts

```json
{
  "scripts": {
    "generate-api": "node -e \"import('@reggieofarrell/http-client/codegen').then(m => m.generateClient({openApiSpec:'./openapi.json',outputDir:'./src/api-client'}))\"",
    "build": "npm run generate-api && tsc"
  }
}
```

### CI/CD Integration

```yaml
# GitHub Actions example
- name: Generate API Client
  run: |
    npm install @reggieofarrell/http-client zod
    node -e "import('@reggieofarrell/http-client/codegen').then(m => m.generateClient({openApiSpec:'./openapi.json',outputDir:'./src/api-client'}))"
```

## Advanced Features

### Custom Error Handling

```typescript
// Enable custom error generation
await generateClient({
  openApiSpec: './openapi.json',
  outputDir: './src/api-client',
  generateCustomErrors: true,
});
```

### Schema Validation

```typescript
// Enable runtime validation
await generateClient({
  openApiSpec: './openapi.json',
  outputDir: './src/api-client',
  validateSchemas: true,
});

// Generated code includes validation
const user = await client.users.createUser(userData); // Validates userData
```

### Custom Naming

The generator automatically converts OpenAPI names to valid TypeScript identifiers:

- `user-profile` → `userProfile`
- `get_user_by_id` → `getUserById`
- `APIResponse` → `APIResponse`

## Troubleshooting

### Common Issues

**Q: Generated code doesn't compile**
A: Ensure you have the required peer dependencies installed:
```bash
npm install zod
```

**Q: Missing route groups**
A: Check that your OpenAPI spec has proper tags or path structure. Use `groupingStrategy: 'path'` for path-based grouping.

**Q: Schema validation errors**
A: The generator creates Zod schemas from OpenAPI schemas. Check that your OpenAPI spec has valid schema definitions.

**Q: Custom error classes not generated**
A: Custom error classes are only generated when API error responses differ from standard HTTP errors. Check your OpenAPI spec for custom error schemas.

### Debug Mode

Enable verbose logging:

```typescript
await generateClient({
  openApiSpec: './openapi.json',
  outputDir: './src/api-client',
  verbose: true, // Enable detailed logging
});
```

## Contributing

The code generator is part of the http-client package. To contribute:

1. Fork the repository
2. Create a feature branch
3. Add tests for new functionality
4. Submit a pull request

## License

This project is licensed under the 0BSD License - see the [LICENSE](LICENSE) file for details.
